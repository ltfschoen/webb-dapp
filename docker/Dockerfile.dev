FROM node:gallium-alpine

ARG NAME_PROJECT=${NAME_PROJECT}
ARG NAME_BRIDGE_DAPP=${NAME_BRIDGE_DAPP}
ARG NAME_STATS_DAPP=${NAME_STATS_DAPP}
ARG PORT_BRIDGE_DAPP=${PORT_BRIDGE_DAPP}
ARG PORT_STATS_DAPP=${PORT_STATS_DAPP}

ARG PATH_DOCKER_PROJECT=/usr/local/${NAME_PROJECT}
ARG BIN1=${PATH_DOCKER_PROJECT}/node_modules/.bin
ARG BIN2=${PATH_DOCKER_PROJECT}/apps/${NAME_BRIDGE_DAPP}/node_modules/.bin
ARG BIN3=${PATH_DOCKER_PROJECT}/apps/${NAME_STATS_DAPP}/node_modules/.bin
ENV PATH=${BIN1}:${BIN2}:${BIN3}:$PATH

WORKDIR ${PATH_DOCKER_PROJECT}

COPY package.json .

RUN yarn

COPY . .

EXPOSE ${PORT_BRIDGE_DAPP}
EXPOSE ${PORT_STATS_DAPP}

CMD tail -f /dev/null
